<!-- In your HTML <head> -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

<!-- Just before </body> -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<script>
  const map = L.map('map').setView([40.7128, -74.0060], 12);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Colored Leaflet default-style icons
  const greenIcon = new L.Icon({
    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
    shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  const orangeIcon = new L.Icon({
    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',
    shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  const repairLayer = L.layerGroup().addTo(map);
  const needRepairLayer = L.layerGroup().addTo(map);

  // Replace this with your Firestore data fetch
  // Example dummy data to test:
  const markers = [
    { lat: 40.72, lng: -74.0, type: 'repair', title: 'Bike Shop', description: 'Fixes cycles' },
    { lat: 40.71, lng: -74.01, type: 'need', title: 'Broken Bench', description: 'Needs fixing' }
  ];

  markers.forEach(data => {
    const popupContent = `<strong>${data.title}</strong><br>${data.description}`;
    const icon = data.type === "repair" ? greenIcon : orangeIcon;

    const marker = L.marker([data.lat, data.lng], { icon })
      .bindPopup(popupContent);

    if (data.type === "repair") {
      marker.addTo(repairLayer);
    } else {
      marker.addTo(needRepairLayer);
    }
  });

  // Layer control
  L.control.layers(null, {
    "Repairs are Happening": repairLayer,
    "Repairs are Needed": needRepairLayer
  }, { collapsed: false }).addTo(map);

  // Working search bar
  L.Control.geocoder({
    defaultMarkGeocode: true
  }).addTo(map);
</script>
