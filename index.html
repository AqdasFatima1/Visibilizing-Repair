<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NYC Repair & Maintenance Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.css" />
  <style>
    body, html { margin: 0; padding: 0; font-family: 'Inter', sans-serif; background: #fff; }
    #map { width: 100vw; height: 100vh; }

    .title {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      font-size: 28px;
      font-weight: bold;
      background: rgba(255, 255, 255, 0.8);
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .description {
      position: absolute;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      font-size: 16px;
      width: 80%;
      max-width: 800px;
      text-align: center;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px 15px;
      border-radius: 10px;
      line-height: 1.6;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .leaflet-control-layers {
      font-family: 'Inter', sans-serif !important;
      font-weight: 500;
      font-size: 15px;
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      padding: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .leaflet-top.leaflet-left .leaflet-control {
      margin-top: 10px;
      margin-left: 10px;
    }

    .leaflet-geosearch-bar {
      max-width: 400px;
      margin: 15px auto;
    }
  </style>
</head>
<body>
  <div class="title">NYC Repair & Maintenance Map</div>
  <div class="description">
    This crowdsourced map visualizes places in NYC where people go to repair and maintain things, alongside areas that need repair. Use the toggle to view either or both layers, and click on points for details.
  </div>
  <div id="map"></div>

  <!-- Leaflet + Color Filter + GeoSearch JS -->
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/xtk93x/Leaflet.TileLayer.ColorFilter@1.2.5/src/leaflet-tilelayer-colorfilter.min.js"></script>
  <script src="https://unpkg.com/leaflet-geosearch@3.0.0/dist/bundle.min.js"></script>

  <script>
    // Initialize map
    const map = L.map('map').setView([40.7128, -74.0060], 12);

    // Subtle orange-tinted basemap
    const baseLayer = L.tileLayer.colorFilter('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      filter: ['hue-rotate(20deg)', 'brightness(1.1)', 'saturate(1.2)'],
      attribution: '&copy; OpenStreetMap & CartoDB contributors'
    }).addTo(map);

    // Dummy data for demonstration
    const repairPlaces = L.layerGroup([
      L.marker([40.7228, -74.001]).bindPopup('Community Repair Center'),
      L.marker([40.715, -74.010]).bindPopup('Bike Repair Spot')
    ]);

    const infrastructureNeeds = L.layerGroup([
      L.marker([40.729, -74.002]).bindPopup('Broken Sidewalk'),
      L.marker([40.713, -74.012]).bindPopup('Streetlight Outage')
    ]);

    const bothLayers = L.layerGroup([repairPlaces, infrastructureNeeds]);

    // Add layer toggles
    const overlays = {
      "<b style='font-weight:600'>Places of Repair</b>": repairPlaces,
      "<b style='font-weight:600'>Needs Repair</b>": infrastructureNeeds,
      "<b style='font-weight:600'>Show Both</b>": bothLayers
    };

    L.control.layers(null, overlays, { collapsed: false }).addTo(map);

    // Add both layers by default
    bothLayers.addTo(map);

    // Add search bar
    const search = new GeoSearch.GeoSearchControl({
      provider: new GeoSearch.OpenStreetMapProvider(),
      style: 'bar',
      showMarker: true,
      showPopup: false,
      autoClose: true,
      searchLabel: 'Search for address or place...',
      keepResult: true
    });
    map.addControl(search);
  </script>
</body>
</html>
