<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Repair Stories</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@300;400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@2.7.0/dist/bundle.min.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Urbanist', sans-serif;
      background-color: #f4f1ec;
    }
    #map {
      height: 100vh;
      width: 100%;
      z-index: 0;
    }
    .title-box {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px 16px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 1000;
      max-width: 300px;
    }
    .title-box h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      color: #5a5a5a;
    }
    .title-box p {
      margin: 8px 0 0;
      font-size: 14px;
      color: #777;
    }
    .leaflet-popup-content {
      font-family: 'Urbanist', sans-serif;
      font-size: 14px;
    }
    .custom-popup {
      color: #333;
    }
    .leaflet-control-geocoder,
    .leaflet-control-geosearch {
      z-index: 2000;
    }
    .leaflet-control-layers {
      font-size: 16px;
      font-weight: 600;
      background-color: rgba(255, 255, 255, 0.95);
      padding: 8px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .leaflet-control-layers label,
    .leaflet-control-layers span {
      font-family: 'Urbanist', sans-serif;
      color: black;
    }
    .search-bar-container {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2000;
      width: 90%;
      max-width: 500px;
    }
    .search-bar {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      background-color: #fff;
    }
  </style>
</head>
<body>
  <div class="title-box">
    <h2>Repair Stories</h2>
    <p>This map collects data on repair practices and infrastructure in need of care.<br><br>
      Click anywhere on the map to share where you go for repairs, or if there is something you know that is in need of repair! You can even add an image if you have one!<br><br>
      Use the toggle to view either where repair happens or where it's needed, or both together.</p>
  </div>

  <div class="search-bar-container">
    <div class="leaflet-control geosearch"></div>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-geosearch@2.7.0/dist/bundle.min.js"></script>

  <script>
    const map = L.map('map').setView([40.7128, -74.0060], 12);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CartoDB contributors',
      className: 'leaflet-warm-toned',
    }).addTo(map);

    const provider = new window.GeoSearch.OpenStreetMapProvider();

    const search = new window.GeoSearch.GeoSearchControl({
      provider: provider,
      style: 'bar',
      showMarker: true,
      showPopup: false,
      autoClose: true,
      retainZoomLevel: false,
      searchLabel: 'Search for a place',
      keepResult: true
    });

    map.addControl(search);

    const greenIcon = new L.Icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    const orangeIcon = new L.Icon({
      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      shadowSize: [41, 41]
    });

    const repairLayer = L.layerGroup().addTo(map);
    const needRepairLayer = L.layerGroup().addTo(map);

    L.control.layers({
      "<span>Something is being Repaired Here!</span>": repairLayer,
      "<span>Something Needs Repair Here!</span>": needRepairLayer
    }, null, { collapsed: false }).addTo(map);
  </script>
</body>
</html>
